# ТЕХНИЧЕСКОЕ ЗАДАНИЕ  
Фуллстек разработка клавиатурного тренажера на языках программирования JS (React) и Go

## 1. ВВЕДЕНИЕ

Наименование программы: **blindtyping**.  
Программа предназначена для пользователей, желающих улучшить навыки слепой печати, повысить скорость и точность набора текста на различных языках и с разными уровнями сложности в игровом формате.

## 2. ОСНОВАНИЕ ДЛЯ РАЗРАБОТКИ

Разработка осуществляется на основании настоящего технического задания.  
Утверждающая организация: **blindtyping**.  
Дата утверждения: **не указана**.  
Тема разработки: **blindtyping**.

## 3. НАЗНАЧЕНИЕ РАЗРАБОТКИ

**Функциональное назначение:**  
Предоставление интерактивной платформы для тестирования и тренировки навыков печати с мгновенной обратной связью, статистикой и системой достижений.

**Эксплуатационное назначение:**  
 Использование в браузере индивидуальными пользователями для саморазвития, в образовательных учреждениях или компаниях для тестирования сотрудников.

## 4. ТРЕБОВАНИЯ К ПРОГРАММНОМУ ИЗДЕЛИЮ

### 4.1. Требования к функциональным характеристикам
- Авторизация пользователей через OAuth 2.0
- Сбор и визуализация статистики пользователей
- Наличие у пользователей публичного профиля со статистикой
- Генерация тестов с выбором режимов и языка
- Система обучения слепой печати
- Настройка пользовательских предпочтений

### 4.2. Требования к надёжности
- Система не хранит пароли пользователей от учетных записей
- Пользователь не может "накрутить" себе статистику (антифрод)
- Отслеживание ключевый пользовательских сценариев через продуктовые метрики
- Запись логов работы сервера

### 4.3. Условия эксплуатации
- Обслуживание: аутсорсинг

### 4.4. Требования к составу и параметрам технических средств
- Компьютер с ОС Windows 10/11, Linux или macOS.
- Процессор: более чем 2 ядра.
- ОЗУ: не менее 4 ГБ (рекомендуется 8 ГБ).
- Свободное место на диске: 2 ГБ (рекомендуется 40 ГБ).
- Установленные ПО: Go 1.24, PostgreSQL 18, Node, npm.

### 4.5. Требования к информационной и программной совместимости
- Входные данные: Ввод с клавиатуры, действия мыши/тач.
- Выходные данные: HTML-страницы, JSON-ответы (API)
- Используемые технологии:
Frontend: ReactJS, NextJS
Backend: Golang
База данных: PostgreSQL, Redis
Прочее: Git, Docker

### 4.6. Требования к маркировке и упаковке
Не предусмотрены (веб-приложение).

### 4.7. Требования к транспортированию и хранению
Не применяются.

### 4.8. Специальные требования
- Производительность: Минимальная задержка между нажатием клавиши и визуальным откликом (< 50 мс).
- Доступность (A11y): Частичная поддержка для пользователей с ограниченными возможностями (семантическая верстка, управление с клавиатуры, высокая контрастность темы).
- Кастомизация: Возможность смены темы (светлая/тёмная/кастомная), размера текста, отключения звуков.
- PWA: Возможность установки как Progressive Web App.

## 5. ТРЕБОВАНИЯ К ПРОГРАММНОЙ ДОКУМЕНТАЦИИ
Состав документации:
- Техническое задание.
- Руководство пользователя.
- Исходный код с комментариями.

## 6. ТЕХНИКО-ЭКОНОМИЧЕСКИЕ ПОКАЗАТЕЛИ
- Монетизация: Реклама, донаты, подписки
- Аудитория: Школьники, студенты, программисты, копирайтеры, все желающие улучшить навык печати.

## 7. СТАДИИ И ЭТАПЫ РАЗРАБОТКИ
1. Разбиение ТЗ на фичи
1. Анализ требований и проектирование
2. Разработка backend и интеграция с БД
3. Разработка frontend.
5. Тестирование и отладка.
6. Подготовка документации.
7. Сдача в эксплуатацию.

Срок разработки: 4 месяца.

## 8. ПОРЯДОК КОНТРОЛЯ И ПРИЁМКИ

**Виды испытаний:**
- Модульное тестирование.
- Интеграционное тестирование.
- Приёмочные испытания.

**Требования к приёмке:**
- Соответствие функциональным требованиям.
- Успешное прохождение всех видов тестирования.

## ПРИЛОЖЕНИЯ
1. Описание структуры проекта и основных модулей.
2. Примеры входных и выходных данных.
3. Инструкция по запуску и настройке среды разработки.

# ОПИСАНИЕ ПРОГРАММЫ

## 1. Общие сведения

**Наименование программы:** Клавиатурный тренажер

**Обозначение программы:** blindtyping

**Программное обеспечение, необходимое для функционирования программы:**
- Операционная система: Windows 10/11 / Linu / MacOS
- Go 1.24+
- Nginx 16
- PostgreSQL 18
- Веб-браузер (Chrome, Firefox, Edge)
- Javascript (Typescript)
- Docker

**Используемые языки программирования:**
- Golang
- JavaScript
- PL/pgSQL

**Языки разметки и стилей:**
- HTML
- CSS

Язык запросов:
- SQL

**Технологии/Фреймворки:**
- Typescript
- React
- NextJS
- Gin
- Goth

## 2. Функциональное назначение

**Класс решаемых задач:** Образовательно-развлекательные, метрические (измерение навыка).

**Назначение программы:**
- Развитие моторной памяти
- Повышение продуктивности при работе с текстом
- Игровой соревновательный элемент.

**Функциональные ограничения на применение:**
- Требуется физическая клавиатура для полноценного использования.
- Без регистрации прогресс не сохраняется.
- Некоторые функции доступны только авторизованным пользователям.

## 3. Описание логической структуры

**Алгоритм программы:**
- Пользователь входит в систему → система проверяет роль → предоставление доступа к модулям:
- Пользователь выбирает параметры теста (язык, время, сложность).
- Генерация или выборка текста из базы.
- Запуск таймера по первому нажатию клавиши.
- Сравнение введенного символа с эталонным, обновление позиции каретки, подсчет ошибок.
- По истечении времени/завершении текста — остановка, расчет финальных метрик.
- Отображение результатов, предложение поделиться или повторить.
- Для авторизованного пользователя — сохранение результата, обновление профиля и лидербордов.

**Используемые методы:**
- Goth для авторизации по протоколу OAuth 2.0
- JWT для генерации токенов доступа и обновления
- Clean Architecture
- UUID

**Структура программы:**
```
internal/
├── app/ - Точка входа
├── services/ - Веб-контроллеры
├── models/ - Сущности базы данных
├── repositories/ - Репозитории для работы с БД
├── services/ - Бизнес-логика
```

**Связи программы с другими программами:**
- Интеграция с базой данных PostgreSQL и Redis
- Frontend

## 4. Используемые технические средства

**Типы электронных вычислительных машин и устройств:**
- Персональный компьютер/ноутбук с процессором Intel Core i3+
- Оперативная память: 4 ГБ минимум, 8 ГБ рекомендуется
- Свободное место на диске: 40 ГБ
- Доступ в интернет для загрузки зависимостей

**Минимальные системные требования:**
- Windows 10/11, Linux, macOS
- Go 1.24+
- 4 ГБ оперативной памяти
- 40 ГБ свободного места на диске

## 5. Вызов и загрузка

**Способ вызова программы с соответствующего носителя данных:**
```bash
# Клонирование репозитория
git clone <repository-url>

# Переход в директорию проекта
cd project

# Сборка проекта
make run local
```
### Входные точки в программу:

- Главная страница: http://localhost:5001

### Адреса загрузки:
- Порт приложения: 5001
- Контекстный путь: / (корневой)

### Использование оперативной памяти:

- Минимальный heap size: 512 МБ
- Рекомендуемый heap size: 1 ГБ

### Объем программы:

- Размер JAR файла: ~50-70 МБ
- Общий объем с зависимостями: ~200-300 МБ

### **Входные данные. Характер, организация и предварительная подготовка входных данных.**

**Учетные данные для аутентификации через OAuth провайдеров:**

| Провайдер | OAuth ID (пример) | Автоматически получаемые данные |
|-----------|-------------------|--------------------------------|
| Google    | 113456789012345678901 | email, имя, фамилия, аватар |
| GitHub    | 1234567           | email, username, аватар |

*Примечание: Парольная аутентификация не используется. Все пользователи входят через OAuth провайдеры.*

**Данные регистрации нового пользователя (после OAuth аутентизации):**

* Никнейм (username) - уникальный идентификатор
* Токен регистрации (registration_token) - передается через httpOnly cookie
* Email - автоматически получается от OAuth провайдера

**Данные для сохранения результата теста печати:**

* Основные метрики:
  * WPM (слов в минуту) - число с плавающей точкой
  * CPM (символов в минуту) - число с плавающей точкой
  * Accuracy (точность) - число с плавающей точкой, процент
  * Продолжительность (durationMs) - целое число, миллисекунды
  * Язык (language) - строка (например, "english", "russian")
  * Режим (mode) - строка (например, "time", "words", "quote")
  * Подрежим (submode) - строка (например, "30s", "60s", "50")
  * Включена ли пунктуация (isPunctuation) - булево значение

* Временные метки:
  * Дата начала теста (startedAt) - строка в формате RFC3339
  * Дата завершения теста (finishedAt) - строка в формате RFC3339
  * Дата создания записи (createdAt) - строка в формате RFC3339

* Идентификаторы:
  * UID (uid) - строка, уникальный идентификатор теста на стороне клиента
  * Пользовательский ID - извлекается из JWT токена

* Данные для защиты от накрутки:
  * Подпись (sign) - HMAC-SHA256 подпись всех метрик
  * Количество незавершенных тестов (uncompletedTestsCount) - целое число
  * Общая длительность незавершенных тестов (uncompletedTestsDurationMs) - целое число

**Данные для изменения профиля пользователя:**

* Новый никнейм (username) - строка, уникальная
* Таймстамп последнего изменения никнейма - проверяется для ограничения частоты изменений

**Данные для модуля антифрода:**

* Пароль администратора антифрода (password) - строка, передается в query-параметре

**Формат, описание и способ кодирования входных данных:**

1. **Для веб-интерфейса (frontend):**
   * Формат: JSON через HTTP/HTTPS запросы
   * Методы: GET, POST, PATCH, DELETE
   * Content-Type: `application/json`
   * Кодировка: UTF-8

2. **Для OAuth провайдеров:**
   * Формат: OAuth 2.0 Authorization Code Flow
   * Callback параметры: `code`, `state`
   * Content-Type: `application/x-www-form-urlencoded`

3. **Для аутентификации:**
   * JWT Access Token - передается в httpOnly cookie
   * JWT Refresh Token - передается в httpOnly cookie
   * Registration Token - передается в httpOnly cookie для незавершенной регистрации

4. **Валидация данных:**
   * **На стороне клиента:** Проверка формата JSON, обязательных полей, диапазонов значений
   * **На стороне сервера:** 
     - Схематическая валидация по OpenAPI спецификации
     - Бизнес-валидация (уникальность username, частота изменений)
     - Проверка антифрод-подписи для статистики
     - Валидация JWT токенов
     - Проверка OAuth state параметров

### **Выходные данные**

**Характер и организация выходных данных:**

* **Веб-интерфейс (через API):**
  * Данные текущего пользователя (`/users/me`)
  * Публичный профиль пользователя (`/users/{username}/profile`)
  * История статистики пользователя (`/users/me/statistics`)
  * Результат сохранения теста с признаком рекорда

* **Статистика и аналитика:**
  * Агрегированная статистика по пользователю:
    - Общее время тренировок (timePlayed)
    - Количество начатых/завершенных тестов
    - Статистика по языкам (languageStats)
    - Персональные рекорды (personalBests) по режимам и языкам
  * Информация о прогрессе:
    - Сдвиг WPM относительно предыдущих результатов
    - Флаг достижения личного рекорда (isPersonalBest)

* **Аутентификационные данные:**
  * JWT токены (устанавливаются в httpOnly cookies)
  * Редиректы для OAuth flow (HTTP 308)
  * Токены регистрации для новых пользователей

* **Антифрод система:**
  * Актуальный ключ для подписи статистики
  * Статус операции ротации ключей

* **Уведомления и ошибки:**
  * Сообщения об успешных операциях
  * Детализированные сообщения об ошибках с кодами
  * Информация о доступности username

**Формат, описание и способ кодирования выходных данных:**

1. **Основной формат ответов API:**
   * Content-Type: `application/json`
   * Кодировка: UTF-8
   * Структура успешных ответов:
     ```json
     {
       "user": { ... },
       "profile": { ... },
       "statistics": [ ... ]
     }
     ```
   * Структура ошибок:
     ```json
     {
       "error": "описание ошибки"
     }
     ```

2. **HTTP статус коды:**
   * 200 - Успешный запрос
   * 201 - Успешное создание (статистики)
   * 308 - Permanent Redirect (OAuth callback)
   * 400 - Неверный запрос (валидация)
   * 401 - Не авторизован
   * 403 - Доступ запрещен
   * 404 - Не найдено
   * 409 - Конфликт (username уже занят)
   * 429 - Слишком много запросов (частая смена username)
   * 500 - Ошибка сервера

3. **Cookies (httpOnly, Secure в production):**
   * `access_token` - JWT access token
   * `refresh_token` - JWT refresh token
   * `registration_token` - токен для завершения регистрации

4. **OAuth редиректы:**
   * Успешная аутентизация: редирект на `logged_in_url`
   * Нужна регистрация: редирект на `registration_url` с установкой registration_token
   * Ошибка: редирект на `error_redirection_url?status=КОД_ОШИБКИ`

### Примеры использования
Запуск в среде разработки: `make run debug`

Настройте config.yaml:

Запустите приложение:
go build


Доступ к приложению:

* Откройте браузер и перейдите по адресу http://localhost:5001
* Зарегистрируйте и войдите через сторонний провайдер
